# ROLLBACK COMPLETO: Eliminar Document AI del Proyecto

## üö® CONTEXTO URGENTE

**Problema:** Document AI result√≥ ser MUY costoso
- 5 llamadas = $500 COP
- Inviable para producci√≥n con miles de formularios
- API ya desactivada en Google Cloud

**Acci√≥n requerida:** Eliminar TODO rastro de Document AI del c√≥digo

---

## üéØ OBJETIVO

Limpiar completamente el proyecto de cualquier integraci√≥n con Document AI:
- ‚úÖ Eliminar archivos relacionados
- ‚úÖ Eliminar imports y referencias
- ‚úÖ Eliminar configuraci√≥n
- ‚úÖ Eliminar dependencias
- ‚úÖ Verificar que no quede nada

---

## üóëÔ∏è ARCHIVOS A ELIMINAR COMPLETAMENTE

### 1. Adapters de Document AI
```bash
# ELIMINAR estos archivos:
src/infrastructure/ocr/document_ai_adapter.py
src/infrastructure/ocr/document_ai_*.py
```

### 2. Modelos relacionados (si existen)
```bash
# ELIMINAR si fueron creados:
src/domain/models/cedula_pair.py  # Solo si fue creado para Document AI
```

### 3. Tests de Document AI
```bash
# ELIMINAR:
tests/test_document_ai.py
tests/test_document_ai_*.py
```

### 4. Scripts de migraci√≥n
```bash
# ELIMINAR cualquier script de migraci√≥n:
scripts/migrate_to_document_ai.py
scripts/test_document_ai.py
```

---

## üîß ARCHIVOS A MODIFICAR

### 1. `requirements.txt`
**ELIMINAR esta l√≠nea:**
```txt
google-cloud-documentai>=2.16.0
```

**Ejecutar despu√©s:**
```bash
pip uninstall google-cloud-documentai -y
```

---

### 2. `src/config/settings.py`
**ELIMINAR toda la secci√≥n de Document AI:**

```python
# ‚ùå ELIMINAR COMPLETAMENTE ESTE BLOQUE:
@dataclass
class DocumentAIConfig:
    """Configuraci√≥n para Document AI"""
    project_id: str
    location: str
    processor_id: str
    
    @classmethod
    def from_env(cls):
        return cls(
            project_id=os.getenv("GCP_PROJECT_ID", "your-project-id"),
            location=os.getenv("DOCUMENT_AI_LOCATION", "us"),
            processor_id=os.getenv("DOCUMENT_AI_PROCESSOR_ID", "9c723fcb489ce9a4")
        )

# ‚ùå ELIMINAR ESTA L√çNEA:
DOCUMENT_AI_CONFIG = DocumentAIConfig.from_env()
```

---

### 3. `src/application/services/ocr_service.py`

**ELIMINAR imports de Document AI:**
```python
# ‚ùå ELIMINAR:
from ..infrastructure.ocr.document_ai_adapter import DocumentAIAdapter
```

**ELIMINAR del constructor:**
```python
# ‚ùå ELIMINAR este par√°metro:
def __init__(self, document_ai_adapter: DocumentAIAdapter):
    self.document_ai = document_ai_adapter
```

**ELIMINAR m√©todos relacionados:**
```python
# ‚ùå ELIMINAR estos m√©todos si existen:
def process_form_e11(self, image_path: str) -> List[str]:
    # Todo el m√©todo que usa document_ai
    
def extract_cedulas_with_names(self, ...):
    # Si usa Document AI
```

---

### 4. `.env`
**ELIMINAR estas variables:**
```bash
# ‚ùå ELIMINAR:
DOCUMENT_AI_LOCATION=us
DOCUMENT_AI_PROCESSOR_ID=9c723fcb489ce9a4
```

---

### 5. `README.md` o documentaci√≥n
**ELIMINAR cualquier menci√≥n a:**
- Document AI
- Form Parser
- Processor ID: 9c723fcb489ce9a4
- Costos de Document AI
- Instrucciones de configuraci√≥n de Document AI

---

## üîç B√öSQUEDA EXHAUSTIVA

Ejecutar estos comandos para encontrar cualquier referencia restante:

```bash
# Buscar "document_ai" en todo el proyecto
grep -r "document_ai" src/ tests/ scripts/

# Buscar "documentai" (sin gui√≥n bajo)
grep -r "documentai" src/ tests/ scripts/

# Buscar "DocumentAI" (camelCase)
grep -r "DocumentAI" src/ tests/ scripts/

# Buscar el processor ID espec√≠fico
grep -r "9c723fcb489ce9a4" .

# Buscar "Form Parser"
grep -r "Form Parser" src/ tests/ scripts/ docs/
```

**Si alguno de estos comandos retorna resultados:** ELIMINAR esas referencias tambi√©n.

---

## ‚úÖ VERIFICACI√ìN POST-ELIMINACI√ìN

### Checklist final:

- [ ] No existe `document_ai_adapter.py`
- [ ] No hay imports de `documentai`
- [ ] `requirements.txt` no tiene `google-cloud-documentai`
- [ ] `.env` no tiene variables `DOCUMENT_AI_*`
- [ ] `grep -r "document_ai" src/` retorna 0 resultados
- [ ] `grep -r "9c723fcb489ce9a4" .` retorna 0 resultados
- [ ] El proyecto sigue funcionando con el OCR anterior

---

## üîÑ RESTAURAR CONFIGURACI√ìN ANTERIOR

Si se modific√≥ `ocr_service.py` para usar Document AI, **restaurar a:**

```python
# RESTAURAR configuraci√≥n previa (Google Vision + Azure)
from ..infrastructure.ocr.google_vision_adapter import GoogleVisionAdapter
from ..infrastructure.ocr.azure_vision_adapter import AzureVisionAdapter
from ..infrastructure.ocr.ensemble_ocr import DigitLevelEnsembleOCR

class OCRService:
    def __init__(
        self, 
        google_adapter: GoogleVisionAdapter,
        azure_adapter: AzureVisionAdapter
    ):
        self.google_ocr = google_adapter
        self.azure_ocr = azure_adapter
        self.ensemble = DigitLevelEnsembleOCR(
            google_adapter,
            azure_adapter
        )
    
    def process_form(self, image_path: str) -> List[str]:
        """Procesar formulario con Dual Ensemble (Google + Azure)"""
        # L√≥gica original del Dual Ensemble
        cedulas = self.ensemble.extract_cedulas(image_path)
        return cedulas
```

---

## üìù ACTUALIZAR DOCUMENTACI√ìN

### En `README.md` o docs principales:

**ELIMINAR:**
```markdown
### Document AI Integration
- Processor ID: 9c723fcb489ce9a4
- Cost: ~$X per 1000 images
```

**MANTENER/RESTAURAR:**
```markdown
### OCR Engine: Dual Ensemble
- Google Vision API: $5 COP/1000 im√°genes
- Azure Computer Vision: $3.44 COP/1000 im√°genes
- Total: $8.60 COP/1000 im√°genes ‚úÖ Econ√≥mico
- Precisi√≥n: 98.5-99%
```

---

## üß™ TESTING POST-LIMPIEZA

Despu√©s de eliminar todo, ejecutar:

```bash
# 1. Verificar que no hay imports rotos
python -m py_compile src/**/*.py

# 2. Ejecutar tests existentes
pytest tests/

# 3. Verificar que el OCR original funciona
python scripts/test_ocr_original.py

# 4. Verificar dependencias
pip check
```

---

## üìä RESUMEN DE COSTOS

### Document AI (DESCARTADO ‚ùå)
- 5 llamadas = $500 COP
- 1000 llamadas = $100,000 COP üí∏
- **INVIABLE para producci√≥n**

### Dual Ensemble (ACTUAL ‚úÖ)
- 1000 im√°genes = $8.60 COP
- 5000 im√°genes/mes = $43 COP
- **ECON√ìMICO y ESCALABLE**

---

## ‚ö†Ô∏è IMPORTANTE

**NO eliminar:**
- ‚ùå Google Vision API adapter (necesario)
- ‚ùå Azure Vision API adapter (necesario)
- ‚ùå Ensemble OCR logic (necesario)
- ‚ùå Preprocesamiento de im√°genes (necesario)

**S√ç eliminar:**
- ‚úÖ TODO lo relacionado con Document AI
- ‚úÖ TODO lo relacionado con Form Parser
- ‚úÖ TODO lo relacionado con processor 9c723fcb489ce9a4

---

## üéØ RESULTADO ESPERADO

Despu√©s de este rollback:
- ‚úÖ Proyecto sin rastros de Document AI
- ‚úÖ Dual Ensemble funcionando (Google + Azure)
- ‚úÖ Costos controlados ($8.60/1000 imgs)
- ‚úÖ C√≥digo limpio y mantenible
- ‚úÖ Sin dependencias innecesarias

---

## üöÄ PR√ìXIMOS PASOS (DESPU√âS DEL ROLLBACK)

1. **Confirmar que Dual Ensemble funciona correctamente**
2. **Optimizar extracci√≥n de nombres** con el sistema actual
3. **Implementar API REST** con FastAPI
4. **Trabajar en auto-correcci√≥n** con Registradur√≠a
5. **Escalar a formato E-14**

---

## üìû COMANDOS R√ÅPIDOS PARA CLAUDE CODE

### Opci√≥n 1: Comando directo
```
Elimina COMPLETAMENTE toda integraci√≥n con Document AI del proyecto:
1. Elimina document_ai_adapter.py y cualquier archivo relacionado
2. Elimina imports de documentai en todos los archivos
3. Elimina configuraci√≥n de Document AI en settings.py
4. Elimina google-cloud-documentai de requirements.txt
5. Busca y elimina CUALQUIER referencia restante a "document_ai", "documentai" o "9c723fcb489ce9a4"
6. Verifica que no quede ning√∫n rastro con grep
7. Confirma que el proyecto compila sin errores
```

### Opci√≥n 2: Paso a paso
```
PASO 1: Busca todos los archivos que contengan "document_ai" o "documentai"
PASO 2: Elimina esos archivos completamente
PASO 3: Busca imports de documentai y elim√≠nalos
PASO 4: Limpia requirements.txt y .env
PASO 5: Ejecuta grep para verificar que no quede nada
PASO 6: Compila el proyecto y confirma que funciona
```

---

**Fecha:** 2025-12-02  
**Acci√≥n:** ROLLBACK COMPLETO de Document AI  
**Raz√≥n:** Costos prohibitivos ($500/5 llamadas)  
**Sistema a mantener:** Dual Ensemble (Google Vision + Azure Vision)