Necesito MAXIMIZAR la precisión de Google Cloud Vision API para extracción de cédulas manuscritas antes de considerar soluciones más costosas. El proyecto ya tiene implementación básica de Vision API, ahora vamos a aplicar TODAS las optimizaciones avanzadas disponibles.

CONTEXTO:
- Aplicación de digitación con Google Cloud Vision API ya funcionando
- Precisión actual con opciones gratuitas (Tesseract, PaddleOCR, EasyOCR): <50%
- Necesitamos alcanzar 90%+ de precisión con Vision API
- Si no lo logramos, se considerará Document AI Custom (~$930k COP inversión)
- Arquitectura hexagonal ya implementada
- Autenticación: gcloud auth application-default

OBJETIVO:
Implementar TODAS las optimizaciones avanzadas de Google Cloud Vision API para maximizar precisión sin costo adicional.

OPTIMIZACIONES A IMPLEMENTAR:

1. CAMBIAR A DOCUMENT_TEXT_DETECTION
Actualmente usamos TEXT_DETECTION (genérico).
Migrar a DOCUMENT_TEXT_DETECTION (especializado en documentos estructurados).

Diferencia crítica:
- TEXT_DETECTION: Para carteles, señales, texto general
- DOCUMENT_TEXT_DETECTION: Entiende estructura de documentos, párrafos, tablas, columnas

Implementar:
- Usar document_text_detection() en lugar de text_detection()
- Procesar respuesta estructurada (pages -> blocks -> paragraphs -> words)

2. USAR BOUNDING BOXES Y CONFIDENCE SCORES
Vision retorna coordenadas exactas y confianza por cada palabra detectada.

Implementar:
- Extraer bounding_box de cada word
- Filtrar por confidence > 0.85
- Usar coordenadas para segmentación inteligente

Estructura de datos:
```python
for page in response.full_text_annotation.pages:
    for block in page.blocks:
        for paragraph in block.paragraphs:
            for word in paragraph.words:
                word_text = ''.join([symbol.text for symbol in word.symbols])
                confidence = word.confidence
                bounding_box = word.bounding_box
                # vertices: [top_left, top_right, bottom_right, bottom_left]
```

3. SEGMENTACIÓN INTELIGENTE POR COORDENADAS
Filtrar solo texto que esté en la columna de cédulas usando bounding boxes.

Implementar:
- Calcular centro X de cada palabra
- Filtrar solo palabras donde: 0.40 * image_width < x_center < 0.60 * image_width
- Esto elimina ruido de otras columnas (nombres, firmas)

4. LANGUAGE HINTS
Configurar contexto de idioma para mejorar precisión.

Implementar:
```python
image_context = vision.ImageContext(
    language_hints=['es']  # Español
)

response = client.document_text_detection(
    image=image,
    image_context=image_context
)
```

5. BATCH PROCESSING
En lugar de 15 llamadas individuales, hacer 1 llamada batch.

Implementar:
- Dividir imagen en 15 regiones (renglones)
- Crear lista de requests
- Usar batch_annotate_images() con hasta 16 imágenes
- Más eficiente, mismo costo

6. PRE-ANÁLISIS DE CALIDAD CON IMAGE_PROPERTIES
Detectar imágenes de mala calidad ANTES de enviar a OCR.

Implementar:
- Llamar image_properties() primero
- Analizar: dominant_colors, crop_hints
- Rechazar imágenes con problemas graves
- Evita gastar requests en imágenes inútiles

7. POST-PROCESAMIENTO CON CORRECCIÓN DE ERRORES COMUNES
Aplicar matriz de confusión de errores típicos en manuscrito.

Implementar matriz de correcciones:
```python
COMMON_ERRORS = {
    # Carácter incorrecto -> Carácter correcto
    'l': '1', 'I': '1', '|': '1',  # Confusión con 1
    'O': '0', 'o': '0',             # Confusión con 0
    'S': '5', 's': '5',             # Confusión con 5
    'B': '8',                        # Confusión con 8
}

def corregir_cedula(text):
    # Si contiene letras, aplicar correcciones
    if not text.isdigit():
        for wrong, correct in COMMON_ERRORS.items():
            text = text.replace(wrong, correct)
    return text
```

8. VALIDACIÓN CONTEXTUAL DE CÉDULAS
Validar que el resultado tenga sentido como cédula colombiana.

Implementar reglas:
- Longitud: 6-10 dígitos
- No puede empezar con 0
- Solo dígitos numéricos
- (Opcional) Validar dígito verificador si aplica

9. FILTRADO POR "APARIENCIA" DE CÉDULA
Antes de validación final, filtrar palabras que podrían ser cédulas.

Implementar: